# VK и Telegram боты для проверки подписок

Проект состоит из двух ботов для Glitch: для ВКонтакте и Telegram с единой базой данных SQLite. Боты предназначены для управления доступом к закрытому Telegram-сообществу на основе оплаты подписки через VK Donut.

## Функциональность

### VK бот:
- Генерирует уникальный 9-значный цифровой код при получении сообщения "оплатил"
- Проверяет наличие доната через API VK Donut (в текущей версии используется заглушка)
- Сохраняет информацию о платеже в базу данных

### Telegram бот:
- Проверяет уникальный код, сгенерированный VK ботом
- При успешной проверке предоставляет ссылку на вступление в группу
- Помечает код как использованный

### Ежедневная проверка:
- Автоматически проверяет активность подписок
- Исключает пользователей с неактивными подписками (если у бота есть права)
- Уведомляет администратора о необходимости удаления пользователей

## Установка и запуск

### Предварительные требования:
- Node.js 16.x или выше
- Токен бота Telegram
- Токен сообщества ВКонтакте

### Шаги по установке:

1. Клонировать репозиторий:
```
git clone https://github.com/yourusername/botvk.git
cd botvk
```

2. Установить зависимости:
```
npm install
```

3. Создать файл `.env` с переменными окружения:
```
# Telegram
TELEGRAM_BOT_TOKEN=your_telegram_bot_token
TELEGRAM_GROUP_LINK=t.me/your_group_link
TG_CHAT_ID=your_chat_id
BOT_CAN_REMOVE=true
ADMIN_TG_ID=admin_telegram_id

# VK
VK_TOKEN=your_vk_token
VK_GROUP_ID=your_vk_group_id

# Database
DB_PATH=./database.sqlite
```

4. Запустить приложение:
```
npm start
```

## Структура проекта

- `index.js` - главный файл, инициализирует приложение
- `db.js` - модуль работы с базой данных
- `utils.js` - утилиты для генерации ключей и проверки донатов
- `vk-bot.js` - бот для ВКонтакте
- `tg-bot.js` - бот для Telegram
- `cron.js` - модуль для ежедневной проверки подписок

## Особенности реализации

- **Уникальность кодов**: При совпадении ключей система автоматически увеличивает длину ключа
- **Одноразовые коды**: После использования код помечается как использованный
- **Единая база данных**: SQLite используется для хранения всех данных
- **Автоматизация**: Ежедневная проверка и деактивация просроченных подписок

## Запуск на Glitch

1. Создайте новый проект на Glitch
2. Импортируйте или скопируйте файлы проекта
3. Настройте переменные окружения в разделе `.env`
4. Проект автоматически запустится 